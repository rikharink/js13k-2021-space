!function(){class t{constructor(){this.t=[],this.i=[]}h(t){return this.t.push(t),{o:()=>this.l(t)}}once(t){this.i.push(t)}l(t){var e=this.t.indexOf(t);e>-1&&this.t.splice(e,1)}u(t){if(this.t.forEach((e=>e(t))),this.i.length>0){const e=this.i;this.i=[],e.forEach((e=>e(t)))}}p(t){return this.h((e=>t.u(e)))}}var e,s;(t=>{t[t.m=0]="GamepadAxisChanged",t[t.g=1]="GamepadButtonDown",t[t.v=2]="GamepadButtonUp"})(e||(e={}));class i extends t{constructor(){super(),this.S=new Map,this.A=.01,this.G=0}get k(){return this.G}get I(){return this.A}set I(t){this.A=t}start(){if(!this.G){window.addEventListener("gamepadconnected",this.connect.bind(this)),window.addEventListener("gamepaddisconnected",this.disconnect.bind(this));for(let t of navigator.getGamepads())null!=t&&this.M(t);this.G=1}}stop(){if(this.G){window.removeEventListener("gamepadconnected",this.connect.bind(this)),window.removeEventListener("gamepaddisconnected",this.disconnect.bind(this));for(let t of navigator.getGamepads())this.B(t);this.G=0}}o(){this.stop()}vibrate(t,e){const s=this.C(t);s&&s.vibrationActuator&&s.vibrationActuator.playEffect("dual-rumble",e)}C(t){return navigator.getGamepads()[t]}connect(t){this.M(t.gamepad)}disconnect(t){this.B(t.gamepad)}M(t){this.S.set(t.index,{F:[],K:[],q:[],D:[]})}B(t){this.S.has(t.index)&&this.S.delete(t.index)}P(){if(0!==this.S.size)for(let[t,e]of this.S)this.T(t,e),this.V(t,e)}T(t,e){let s=navigator.getGamepads()[t];if(!s)return;e.F=Array(s.buttons.length),e.K=Array(s.axes.length);for(let t=0;e.D.length>t;t++)e.F[t]=e.D[t];for(let t=0;e.q.length>t;t++)e.K[t]=e.q[t];e.D.length=0;let i=[];if(s.buttons)for(let t=0,e=s.buttons.length;e>t;t++)i[t]=s.buttons[t].pressed?s.buttons[t]:void 0;e.D=i,e.q=[];let h=[];if(s.axes)for(let t=0,e=s.axes.length;e>t;t++)h[t]=this.$(s.axes[t]);e.q=h}$(t){let e=(Math.abs(t)-this.A)/(1-this.A);return 0>e&&(e=0),e*(t>0?1:-1)}V(t,s){let i=s.F,h=s.D;for(let s=0;h.length>s;s++){let a=i[s],n=h[s];n&&this.u({type:e.g,_:t,button:s,value:n.value}),a&&!n&&this.u({type:e.v,_:t,button:s})}let a=s.q.map(((t,e)=>t-(s.K[e]??0)));for(let i=0;a.length>i;i++)0!==a[i]&&this.u({type:e.m,_:t,axis:i,U:s.q[i],oldValue:s.K[i],j:a[i]})}}(t=>{t[t.Keyboard=0]="Keyboard",t[t.H=1]="Pointer",t[t.J=2]="Mouse",t[t.Gamepad=3]="Gamepad"})(s||(s={}));class h extends t{constructor(){super(),this.L=new i,this.N=new Map,this.O=new Map,this.R=new Set,this.W=new Set,this.X=new Set,window.addEventListener("keydown",this.Y.bind(this)),window.addEventListener("keyup",this.Y.bind(this)),window.addEventListener("blur",this.Z.bind(this)),this.L.start(),this.L.h(this.tt.bind(this))}P(){this.L.P()}get et(){return this.L}st(t){return this.X.has(t)}Z(){this.X.clear()}Y(t){for(let e of this.R){let i=this.N.get(e)?.filter((t=>t.type==s.Keyboard)).map((t=>t));for(let s of i??[])s.key&&s.key!=t.key||s.it&&!s.it(t)||(this.ht(e,"keydown"===t.type?"pressed":"released"),t.preventDefault())}}tt(t){for(let i of this.W){let h,a=this.N.get(i)?.filter((t=>t.type==s.Gamepad)).map((t=>t));t.type!==e.g&&t.type!==e.v||(h=t.button);for(let s of a??[])if(void 0!==s.button&&s.button===h||s.it?.(t)){let s;switch(t.type){case e.g:s="pressed";break;case e.v:s="released";break;case e.m:s="changed"}this.ht(i,s)}}}at(t,e){let s=[];return s.push(`${t}-${e}`),"released"===e&&s.push(t),s}ht(t,e){"pressed"===e?this.X.add(t):"released"===e&&this.X.delete(t);let s=this.at(t,e),i=this.O.get(t)?.flatMap((t=>this.at(t,e)))??[];s.push(...i);for(let t of s)this.u(t)}nt(t){t.rt&&this.O.set(t.action,t.rt);for(let e of t.inputs)this.subscribe(t.action,e)}ot(...t){for(let e of t)this.nt(e)}dt(t,e){this.N.has(t)?this.N.get(t).push(e):this.N.set(t,[e])}subscribe(t,e){switch(this.dt(t,e),e.type){case s.Keyboard:return this.ct(t);case s.Gamepad:return this.lt(t)}}ct(t){this.R.add(t)}lt(t){this.W.add(t)}}new class{constructor(){this.ut=new h,this.ft=0,this.wt=0,this.bt=0,requestAnimationFrame(this.P.bind(this)),this.gt=document.getElementById("g"),this.gt.width=640,this.gt.height=480,this.vt=this.gt.getContext("webgl2"),this.yt=[39/255,39/255,68/255]}P(t){requestAnimationFrame(this.P.bind(this)),t=this.St(t),this.ut.P(),this.xt(t)}xt(t){const e=this.vt;e.clearColor(this.yt[0],this.yt[1],this.yt[2],1),e.clear(e.COLOR_BUFFER_BIT)}St(t){let e=(t*=.001)-this.bt;return this.bt=t,this.wt+=e,this.ft=.9*this.ft+1/e*(1-.9),1>this.wt||(e=0),t}}}();
//# sourceMappingURL=bundle.js.map
